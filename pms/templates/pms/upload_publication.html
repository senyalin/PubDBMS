{%extends "./base.html"%}
{% load static %}
{%block cssPart%}
    <link href="{% static 'pms/css/plugins/toastr/toastr.min.css'%}" rel="stylesheet">
	<link href="{% static 'pms/css/bootstrap.min.css'%}" rel="stylesheet">
    <link href="{% static 'pms/css/font-awesome/css/font-awesome.css'%}" rel="stylesheet">
	<link href="{% static 'pms/css/plugins/datapicker/datepicker3.css'%}" rel="stylesheet">
    <link href="{% static 'pms/css/plugins/iCheck/custom.css'%}" rel="stylesheet">
    <link href="{% static 'pms/css/animate.css'%}" rel="stylesheet">
    <link href="{% static 'pms/css/style.css'%}" rel="stylesheet">
	<link href="{% static 'pms/css/plugins/dropzone/dropzone.css'%}" rel="stylesheet">
    <link href="{% static 'pms/css/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css'%}" rel="stylesheet">
	<link href="{% static 'pms/css/plugins/sweetalert/sweetalert2.min.css'%}" rel="stylesheet">
	<style>
        .divBackground{
            border: 1px solid rgba(0,0,0,0.02);
            background: rgba(0,0,0,0.04);
            padding: 10px;
            padding-top: 6px;
			padding-left: 0px;
			padding-right: 0px;
            padding-bottom: 1px;
        }
        .buttonWidth {
            width: 100px;
        }
        .dropzoneCSS{
            height: 432px;        
        }
    </style>
{%endblock%}
	
{%block divPart%}
			<div class="row">
				<div class="ibox-title">
					<h3><strong>Upload Publication</strong></h3>
				</div>
				<div class="ibox-content">
					<div class="row divBackground">
							<form action="" method="post" enctype="multipart/form-data" id="dropzoneForm" >
								<div class="col-sm-4 ">
                                
									{% csrf_token %}
									<div class="form-group">
										<label class="control-label" for="source">Title</label>
										<input type="text" name="title" placeholder="The tile of your publication" class="form-control">
									</div>
									<div class="form-group">
										<label class="control-label" for="keywords">keywords</label>
										<input type="text" name="keywords" placeholder="All keywords, seperated with &quot;,&quot;" class="form-control">
									</div>
									
									<div class="form-group">
										<label class="control-label" for="authors">Authors</label>
										<input type="text" name="authors" placeholder="All authors, seperated with &quot;,&quot;" class="form-control">
									</div>
									<div class="form-group">
										<label class="control-label" for="institution">Institution</label>
										<input type="text" name="institution" placeholder="The institution you're affiliated to" class="form-control">
									</div>
									<div class="form-group">
										<label class="control-label" for="category">Category</label>
										<select name="category" id="category" class="form-control">
											<option value="1" selected="">Conference</option>
											<option value="0">Journal</option>
										</select>
									</div>
                                    <div class="form-group" id="date1">
										<label class="control-label" for="publication_date">Publication Date</label>
										<div class="input-group date">
											<span class="input-group-addon"><i class="fa fa-calendar"></i></span><input type="text" id="publication_date" name="publication_date" placeholder="When was the publication" class="form-control">
										</div>
									</div>
									
									<div class="form-group">
										<label class="control-label" for="price">Price</label>
										<div class="input-group date">
											<span class="input-group-addon">$</span>
											<input type="text" name="price" placeholder="Publication price if public" class="form-control">
										</div>
									</div>
									<div class="form-group">
										<label class="control-label" for="public_or_not">Ownership</label>
										<fieldset>
										<div class="i-checks">
										<label class=""> 
										<div class="iradio_square-green" style="position: relative;">
											<input type="radio" value="1" name="public_or_not" style="position: absolute; opacity: 0;" checked>
										<ins class="iCheck-helper" style="position: absolute; top: 0%; left: 0%; display: block; width: 100%; height: 100%; margin: 0px; padding: 0px; background: rgb(255, 255, 255); border: 0px; opacity: 0;"></ins></div> <i></i> Public &nbsp;&nbsp;&nbsp;&nbsp;</label>
										
										<label class=""> 
										<div class="iradio_square-green" style="position: relative;">
											<input type="radio" value="0" name="public_or_not" style="position: absolute; opacity: 0;">
										<ins class="iCheck-helper" style="position: absolute; top: 0%; left: 0%; display: block; width: 100%; height: 100%; margin: 0px; padding: 0px; background: rgb(255, 255, 255); border: 0px; opacity: 0;"></ins></div><i></i> Private </label></div>
										</fieldset>
									</div>
									
                                    <div>
                                        <button type="button" class="ladda-button ladda-button-demo btn btn-primary full-width m-b " id="upload_all" data-style="zoom-in">
											<span class="ladda-label"><strong>Upload</strong></span>
											<span class="ladda-spinner"></span>
										</button>
                                    </div>
								</div>
								<div class="col-sm-8">
									<div  class="form-group">
										<label class="control-label" for="description">Abstract</label>
										<textarea id="abstract" name="abstract" class="form-control" placeholder="Place your abstract of this publication here." rows="6"></textarea>
								   </div>
									<div id="dropzoneDiv" class="form-group dropzone dropzoneCSS">
										<label class="control-label">DropZone Area</label>
										<div class="dropzone-previews" ></div>
									</div>
									
								</div>
							</form>
                        </div>
													
				</div>
			</div>
{%endblock%}

{%block jsPart%}
    <!-- Mainly scripts -->
    <script src="{% static 'pms/js/jquery-2.1.1.js'%}"></script>
    <script src="{% static 'pms/js/bootstrap.min.js'%}"></script>
    <script src="{% static 'pms/js/plugins/metisMenu/jquery.metisMenu.js'%}"></script>
    <script src="{% static 'pms/js/plugins/slimscroll/jquery.slimscroll.min.js'%}"></script>

    <!-- Custom and plugin javascript -->
    <script src="{% static 'pms/js/inspinia.js' %}"></script>
    <script src="{% static 'pms/js/plugins/pace/pace.min.js' %}"></script>

    <!-- iCheck -->
    <script src="{% static 'pms/js/plugins/iCheck/icheck.min.js' %}"></script>
	<script>
		$(document).ready(function () {
			$('.i-checks').iCheck({
				checkboxClass: 'icheckbox_square-green',
				radioClass: 'iradio_square-green',
			});
		});
	</script>
	<!-- Toastr -->
    <script src="{% static 'pms/js/plugins/toastr/toastr.min.js' %}"></script>
	<!-- Sweet alert -->
    <script src="{% static 'pms/js/plugins/sweetalert/sweetalert2.min.js'%}"></script>
	<script src="{% static 'pms/js/plugins/dropzone/dropzone.js' %}"></script>
	<!-- Data picker -->
	<script src="{% static 'pms/js/plugins/datapicker/bootstrap-datepicker.js' %}"></script>
	
	<script>
		$(document).ready(function() {
			
			$('#date1 .input-group.date').datepicker({
				todayBtn: "linked",
				keyboardNavigation: false,
				forceParse: false,
				calendarWeeks: true,
				autoclose: true
			});

			function getCookie(name) {
				var cookieValue = null;
				if (document.cookie && document.cookie != '') {
					var cookies = document.cookie.split(';');
					for (var i = 0; i < cookies.length; i++) {
						var cookie = jQuery.trim(cookies[i]);
						// Does this cookie string begin with the name we want?
						if (cookie.substring(0, name.length + 1) == (name + '=')) {
							cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
							break;
						}   
					}   
				}   
				return cookieValue;
			}
			Dropzone.autoDiscover = false;
			new Dropzone("#dropzoneDiv", {
				url: "{%url 'upload_publication'%}",
                autoProcessQueue: false,
				paramName: "file_data",
                uploadMultiple: false,
                parallelUploads: 1,
                maxFiles: 1,
				addRemoveLinks: true,
				params: {'csrfmiddlewaretoken': getCookie('csrftoken')},
				
                // Dropzone settings
                init: function() {
					var uploadButton = document.querySelector("#upload_all")
                    var myDropzone = this;
					uploadButton.addEventListener("click", function(e) {
						if(myDropzone.getQueuedFiles().length == 0){
							swal({
								title:"", 
								text: "Drop a file before uploading!", 
								type: "warning",
								confirmButtonClass: 'btn btn-primary m-b buttonWidth',
								buttonsStyling: false
							});
						}else{
							e.preventDefault();
							e.stopPropagation();
							myDropzone.processQueue();
						}
                    });
                    this.on("addedfile", function(file){
						if(this.files.length > 1){
							this.removeFile(this.files[0]);
						}
					});
					this.on("sending", function(data, xhr, formData) {
						formData.append("title", $("form input[name=title]").val());
						formData.append("category", $("#category").val());
						formData.append("authors", $("form input[name=authors]").val());
						formData.append("institution", $("form input[name=institution]").val());
						formData.append("publication_date", $("form input[name=publication_date]").val());
						formData.append("keywords", $("form input[name=keywords]").val());
						formData.append("price", $("form input[name=price]").val());
						formData.append("public_or_not", $("form input[name=public_or_not]:checked").val());
						formData.append("abstract", $("textarea#abstract").val());
						
					});
					this.on("success", function(file, response){
                      swal({
                            title:"Success", 
                            text: "Publication got uploaded successfully!", 
                            type: "success",
                            confirmButtonClass: 'btn btn-primary m-b buttonWidth',
                            buttonsStyling: false
                        }).then(function(){
                            $(location).prop("href", "{%url 'upload_publication'%}")
                        });;
                        
					});
					this.on("error", function(file, response){
                      swal({
							title:"", 
							text: response, 
							type: "warning",
							confirmButtonClass: 'btn btn-primary m-b buttonWidth',
							buttonsStyling: false
						});
					});
                }
            });
		});
	</script>
	<script>
        function getWeekDate(){
            var today = new Date();
			var month = today.getMonth();
			month = month < 9 ? "0" + (month + 1) : (month + 1)
			var day = today.getDate()
			var year = today.getFullYear()
            var weekdays = new Array(7);
			weekdays[0] =  "Sunday";
			weekdays[1] = "Monday";
			weekdays[2] = "Tuesday";
			weekdays[3] = "Wednesday";
			weekdays[4] = "Thursday";
			weekdays[5] = "Friday";
			weekdays[6] = "Saturday";
    		return month + "/" + day + "/" + year + ", " + weekdays[today.getDay()];
        }
	</script>
	<script src="{% static 'pms/js/plugins/validate/jquery.validate.min.js'%}"></script>
{%endblock%}